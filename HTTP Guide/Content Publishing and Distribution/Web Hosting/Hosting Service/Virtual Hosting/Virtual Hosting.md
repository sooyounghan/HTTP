-----
### 가상 호스팅 동작
-----
1. HTTP 설계자들은 공유 서버인 가상 호스팅을 고려하지 않았음
   - 그래서 URL에 있는 호스트 명 정보는 필요 없는 것으로 여겨 명세에서 제외하고, 단순히 경로 컴포넌트만 전송하도록 설계

2. 초기 명세는 가상 호스팅을 고려하지 않았으므로, 웹 호스팅 업자는 공용 가상 호스팅을 지원하는데 필요한 차선책과 컨벤션을 개발해야 했음
   - 이 문제는 모든 HTTP 요청 메세지에 경로 컴포넌트만 보내는 것이 아니라 완전한 URI도 포함해 보내게 해서 간단 해결
   - HTTP/1.1을 지원하는 서버는 HTTP 요청 메세지에 있는 전체 URL을 처리할 수 있어야 함

3. URL 경로를 통한 가상 호스팅 : 서버가 어떤 사이트를 요청하는 것인지 알 수 있게 URL에 특별한 경로 컴포넌트를 추가
   - 공용 서버에 있는 각 가상 사이트에 서로 다른 URL 경로를 할당해 강제로 각각 구분
   - 예) 논리적인 웹 사이트마다 특정 경로를 앞에 붙일 수 있음
     + 죠의 컴퓨터 가게 : ```http://www.joes-hardware.com/joe/index.html```
     + 메리의 골동품 가게 : ```http://www.marys-antiques.com/mary/index.html```
   - 서버에 요청이 도착하면 호스트 명 정보가 요청에 포함되어 있지 않지만, 경로에 있는 정보룰 통해 다음과 같이 이해
     + GET /joe/index.html은 죠의 컴퓨터 가게에 대한 요청
     + GET /mary/index.html은 메리의 골동품 가게에 대한 요청
   - /joe와 /mary 접두어는 불필요하고 혼란스러움으로, 좋은 해결책이 아니며, 일반적으로 홈페에지로 갈 때 사용하는 URL은 동작하지 않음
   - 따라서, 이 방법은 좋지 않은 방법이라 거의 사용하지 않음

4. 포트 번호를 통한 가상 호스팅 : 각 사이트에 다른 포트번호를 할당하여, 분리된 웹 서버의 인스턴스가 요청을 처리
   - 경로 명을 변경하는 대신, 죠와 메리는 웹 서버에 각각 다른 포트번호 할당 가능
   - 예) 80 포트 대신 죠는 82, 메리는 83으로 할 수 있음
   - 하지만, 사용자는 URL 비표준 포트를 쓰지 않고서도 리소스를 찾길 원하므로 문제 발생

5. IP 주소를 통한 가상 호스팅 : 각 가상 사이트에 별도의 IP 주소를 할당하고, 모든 IP 주소를 장비 하나에 연결 (웹 서버는 IP 주소로 사이트 이름을 식별)
   - 훨씬 더 좋은 접근 방법으로, 각 가상 웹 사이트에 유일한 IP 주소를 한 개 이상 부여
   - 모든 가상 서버의 IP 주소는 같은 공용 서버에 연결되어 있으므로, 서버는 HTTP 커넥션의 목적지 IP 주소를 보고 클라이언트가 어떤 웹 사이트에 연결하려고 하는지 알 수 있음
   - 호스팅 업자가 ```209.172.34.3```을 ```www.joes-hardware.com```에, ```209.172.34.4```를 ```www.marys-antiques.com```에 할당하고, 두 IP 주소를 같은 물리 서버에 연결
     + 웹 서버는 어떤 가상 사이트에 요청한 것인지 식별하고 목적지 IP 주소 사용
<div align="center">
<img src="https://github.com/user-attachments/assets/74506757-fb8d-4359-bcf6-a7284c178349">
</div>

   - 클라이언트 A는 ```http://www.joes-hardware.com/index.html``` 요청
   - 클라이언트 A는 ```http://www.joes-hardware.com```의 IP 주소를 요청해 ```209.172.34.3```을 얻음
   - 클라이언트 A는 ```209.172.34.3```에 있는 공용 웹 서버에 TCP 커넥션을 맺음
   - 클라이언트 A는 GET /index.html HTTP/1.0 요청을 보냄
   - 웹 서버가 응답을 전송하기 앞서, 실제 목적지 IP 주소(```209.172.34.3```)를 기록하고, 죠에 웹 사이트에 대한 가상 IP 주소라는 것을 판단하고, /joe 하위 디렉토리에 요청을 처리하며, /joe/index.html 페이지를 반환

   - 클라이언트 B가 ```http://www.marys-antiques.com/index.html```을 처리하는 방법
     + 클라이언트 B는 ```http://www.marys-antiques.com/```에 대한 IP 주솔ㄹ 찾고 ```209.172.34.4```를 얻음
     + 클라이언트 B는 ```209.72.34.4```에 있는 웹 서버에 TCP 커넥션을 맺음
     + 클라이언트 B는 GET /index.html HTTP/1.0 요청을 보냄
     + ```209.172.34.4```가 메리의 웹 사이트라고 판단하고, /mary 하위 디렉토리에서 요청을 처리하며, /mary/index.html 페이지 반환

   - 가상 IP 호스팅은 잘 동작하지만, 규모가 아주 큰 호스팅 업자에게는 어려운 문제 존재
     + 일반적으로 컴퓨터 시스템이 연결할 수 있는 장비의 IP 개수는 제한이 존재 (호스팅 업자는 수백 혹은 수천 개의 가상 사이트를 포함하는 공용 서버를 제공해야함)
     + IP 주소는 희소 상품으로, 가상 사이트를 많이 가지고 있는 호스팅 업자는 호스팅하는 모든 웹 사이트에 할당할 가상 IP 주소를 충분히 얻지 못할 수 있음
     + IP 주소가 부족한 문제는 호스팅 업자가 용량을 늘리려고 서버를 복제하면서 더 심각해짐 : 부하 균형의 구조상, 각 복제된 서버에 IP 주소를 부여해야 하므로, IP 주소는 복제 서버 개수만큼 더 필요하게 됨

   - IP 주소 부족 문제가 발생할 수 있지만, 널리 쓰이는 방식

6. Host 헤더를 통한 가상 호스팅 : HTTP/1.0 개선 버전과 HTTP/1.1 공식 버전은 사이트 이름을 알려주는 Host 요청 헤더를 정의하여, 웹 서버는 Host 헤더로 가상 사이트 식별 가능
   - IP 주소 낭비와 가상 IP 제한 문제를 피하려면, 가상 사이트들이 같은 IP를 사용하더라도 각 사이트가 어디에 속하는지 알 수 있어야 함
   - 브라우저 대부분이 URL 경로 컴포넌트만 서버에 전달하므로, 중요한 가상 호스트 명 정보는 받지 못함
   - 이 문제를 해결하고자, 브라우저와 서버 개발자들은 서버가 원 호스트 명을 받아 볼 수 있게 HTTP 확장
   - 하지만, 대부분 서버가 경로 컴포넌트만 받아 요청을 처리할 수 있으므로, 브라우저가 전체 URL을 보내더라도 소용 없음
   - 대신, 모든 요청에 호스트 명(그리고 포트)을 Host 확장 헤더에 기술해서 전달
<div align="center">
<img src="https://github.com/user-attachments/assets/6be44fef-e658-47af-80b1-644073027b36">
</div>

   - Host 헤더는 관련 업체들이 HTTP/1.0을 확장해 만든 HTTP/1.0+에서 처음 소개
   - HTTP/1.1 명세를 따르려면 Host 헤더를 반드시 기술해야 함
   - Host 헤더는 브라우저와 서버 대부분이 지원
