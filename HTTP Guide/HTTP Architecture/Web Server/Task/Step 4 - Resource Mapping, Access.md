-----
### 단계 4 : 리소스 매핑과 접근
-----
1. 웹 서버는 리소스 서버로, HTML 페이지나 JPEG 이미지 같은 미리 만들어진 콘텐츠를 제공하며, 마찬가지로 서버 위에서 동작하는 리소스 생성 애플리케이션을 통해 만들어진 동적 콘텐츠도 제공
2. 웹 서버가 클라이언트에 콘텐츠를 전달하려면, 그 전에 요청 메세지의 URI에 대응하는 알맞은 콘텐츠나 콘텐츠 생성기를 웹 서버에서 찾아서 그 콘텐츠의 원천을 식별해야 함
3. Docroot
   - 웹 서버는 여러 종류의 리소스 매핑 지원
   - 하지만 리소스 매핑의 가장 단순한 형태는 요청 URI를 웹 서버의 파일 시스템 안에 있는 파일 이름으로 사용하는 것
   - 일반적으로 웹 서버 파일 시스템의 특별한 폴더를 웹 콘텐츠를 위해 예약해둠 : 이 폴더는 문서 루트 혹은 docroot라고 불림
   - 웹 서버는 요청 메세지에서 URI를 가져와 문서 루트 뒤에 붙임
<div align="center">
<img src="https://github.com/user-attachments/assets/b8bec77f-cc94-448f-b3d1-bf688d5c3ace">
</div>

   - /specials/saw-blade.gif에 대한 요청이 도착하면, 웹 서버는 문서 루트 /usr/local/httpd/files를 갖고 있으므로, 웹 서버는 /usr/local/httpd/files/specials/saw-blade.gif 파일을 반환
   - 다음과 같이 httpd.conf 설정 파일에 DocumentRoot 줄을 추가하여 아파치 웹 서버의 문서 루트를 설정 가능
<div align="center">
<img src="https://github.com/user-attachments/assets/190a1f1a-faeb-4cac-856f-6270a245d7f1">
</div>

   - 서버는 상대적인 URL이 docroot를 벗어나서 파일 시스템의 docroot 이외 부분이 노출되는 일이 생기지 않도록 주의해야 함

4. 가상 호스팅된 docroot
   - 가상 호스팅 웹 서버는 각 사이트에 그들만의 분리된 문서 루트를 주는 방법으로 한 웹 서버에서 여러 개의 웹 사이트를 호스팅
   - 가상 호스팅 웹 서버는 URI나 Host 헤더에서 얻은 IP 주소나 호스트 명을 이용해 올바른 문서 루트 식별
   - 이 방법으로, 하나의 웹 서버 위에서 두 개의 사이트 완전히 분리된 콘텐츠를 갖고 호스팅되도록 할 수 있음
   - 서버는 두 사이트 ```www.joes-hardware.com```와 ```www.marys-antiques.com```을 호스팅하며, 서버는 두 웹 사이트를 HTTP Host 헤더나 서로 다른 IP 주소를 이용해 구분할 수 있음
<div align="center">
<img src="https://github.com/user-attachments/assets/b59949dd-d695-4b29-8289-398901fad90a">
</div>

   - 요청 A가 도착했을 때, 서버는 /docs/joe/index.html 파일을 가져옴
   - 요청 B가 도착했을 때, 서버는 /doc/mary/index.html 파일을 가져옴

   - 가상으로 호스팅 되는 docroot 설정은 대부분 웹 서버에서 간단함 : 널리 쓰이는 아파치 웹 서버에서는 각 가상 웹 사이트의 VirtualHost 블록이 가상 서버에 대한 DocumnetRoot 지시자를 포함하도록 설정해야 함
<div align="center">
<img src="https://github.com/user-attachments/assets/b4e4a068-da58-4ae1-9c9d-2f8c2ba9e387">
</div>

5. 사용자 홈 디렉토리 docroots
   - docroots의 또 다른 대표적인 활동은 사용자들이 한 대의 웹 서버에서 각자의 개인 웹 사이트를 만들 수 있도록 해주는 것
   - 보통 빗금(/)과 물결표(~) 다음에 사용자 이름이 오는 것으로 시작하는 URI는 그 사용자에게 개인 문서 루트를 가리킴
   - 개인 docroot는 주로 사용자 홈 디렉토리 안에 있는 public_html로 불리는 디렉토리지만, 설정에 따라 다름
<div align="center">
<img src="https://github.com/user-attachments/assets/d7fe6b1b-e54a-4161-a935-80bd1d4aecd9">
</div>

6. 디렉토리 목록
   - 웹 서버는 경로가 파일이 아닌 디렉토리를 가리키는 디렉토리 URL에 대한 요청을 받을 수 있음
   - 대부분의 웹 서버는 클라이언트가 디렉토리 URL을 요청했을 때 아래 몇 가지 행동을 취하도록 설정할 수 있음
     + 에러 반환
     + 디렉터리 대신 특별한 색인 파일 반환
     + 디렉토리를 탐색해서 그 내용을 담은 HTML 페이지를 반환

   - 대부분의 웹 서버는 요청한 URL에 대응되는 디렉토리 안에서 index.html 혹은 index.htm으로 이름 붙은 파일을 찾음
   - 만약 사용자가 어떤 디렉토리에 대한 URL를 요청했는데, 그 디렉토리가 index.html 혹은 index.htm이란 이름을 가진 파일을 갖고 있다면, 서버는 그 파일의 콘텐츠를 반환
   - 아파치 웹 서버에서 DirectoryIndex 설정 지시자를 사용해 기본 디렉토리 파일로 사용될 파일 이름의 집합을 설정할 수 있음
     + DirectroyIndex 지시자는 디렉토리 색인 파일로 모든 파일의 이름을 우선순위로 나열
     + 아파치가 디렉토리 URL 요청에 대한 응답으로 나열된 파일 중 하나를 찾게 만듬
<div align="center">
<img src="https://github.com/user-attachments/assets/5085889e-63fb-4ff9-9a94-c419ad858456">
</div>

   - 사용자가 디렉토리 URI를 요청했을 때, 기본 색인 파일이 없고 디렉토리 색인 기능이 꺼져있다면, 많은 웹 서버는 자동으로 그 디렉토리 파일들을 크기 / 변경일 및 그 파일에 대한 링크와 함께 열거한 HTML 파일을 반환
   - 이 파일 열거는 편리하기 하지만, 일반적으로 발견할 수 없는 파일도 드러나게 되는 단점 존재
   - 아파치 지시자로 디렉토리 색인 파일 자동 생성 종료 가능 : ```Options -Indexes```

7. 동적 콘텐츠 리소스 매핑
   - 웹 서버는 URI를 통해 동적 리소스에 매핑할 수 있음
   - 즉, 요청에 맞게 콘텐츠를 생성하는 프로그램에 URI를 매핑하는 것
<div align="center">
<img src="https://github.com/user-attachments/assets/5787ccd9-f2d5-451b-9020-e8160adbc9f0">
</div>

   - 웹 서버들 중에서는 애플리케이션 서버라고 불리는 것들은 웹 서버를 복잡한 백엔드 애플리케이션과 연결하는 일을 함
   - 어떤 리소스가 동적 리소스라면, 애플리케이션 서버는 그에 대한 동적 콘텐츠 생성 프로그램이 어디에 있는지, 그리고 어떻게 그 프로그램을 실행하는지 알려줄 수 있어야 함
   - 대부분의 웹 서버는 동적 리소스를 식별하고, 매핑할 수 있는 기본 메커니즘을 가지고 있음
   - 아파치는 URI 경로 상 실행 가능한 프로그램이 위치한 디렉토리로 매핑되도록 설정하는 기능 제공
     + 서버가 실행 가능한 경로명을 포함한 URI로 요청을 받으면, 그 경로에 대응하는 디렉토리에서 프로그램을 찾아 실행하려 시도
     + 예를 들어, 다음의 아파치 설정 지시자는 URI 정보가 /cgi-bin/으로 시작한다면 /usr/local/etc/httpd/cgi-programs/에서 프로그램을 찾아 실행하라는 의미
<div align="center">
<img src="https://github.com/user-attachments/assets/6bb52d23-9744-465f-a0b5-4cb7a5887cf3">
</div>

   - 또한, 아파치에서는 특정 확장자의 파일만 실행하도록 설정 가능
     + 이 방법은 실행 가능한 스크립트를 아무 디렉토리에나 위치 가능
     + 다음의 아파치 설정 지시자는 .cgi로 끝나는 모든 웹 리소스는 실행되어야 함을 명시
<div align="center">
<img src="https://github.com/user-attachments/assets/6b83172c-c506-44e6-aaaf-89c64c4d1e6a">
</div>

   - 웹 초창기에 널리 쓰였던 CGI는 서버사이드 애플리케이션을 실행하기 위한 간단한 인터페이스로, 오늘날 애플리케이션 서버는 마이크로소프트 액티 서버 페이지와 자바 서블릿과 같은 한층 더 강력하고 효과적인 서버사이드 동적 콘텐츠 지원 기능을 가지고 있음

8. 서버사이드 인클루드(Server-Side Includes, SSI)
   - 많은 웹 서버는 서버사이드 인클루드도 지원
   - 만약, 어떤 리소스가 이를 포함하고 있는 것으로 설정되면, 서버는 그 리소스의 콘텐츠를 클라이언트에게 보내기 전 처리
   - 서버는 콘텐츠에 변수 이름이나 내장된 스크립트가 될 수 있는 특별한 패턴이 있는지(주로 특별한 HTML 주석 안 포함) 검사를 받음
   - 특별한 패턴은 변수 값이나 실행 가능한 스크립트의 출력 값으로 치환되며, 이는 동적 콘텐츠를 만들기 쉬운 방법

9. 접근 제어
    - 웹 서버는 또한 각 리소스에 대해 접근 제어 할당 가능
    - 접근 제어되는 리소스에 대한 요청이 도착했을 때, 웹 서버는 클라이언트의 IP 주소에 그건개 접근을 제어할 수 있고, 혹은 리소스에 접근하기 위해 비밀번호 요청 가능
   
