-----
### Via 헤더
-----
1. 메세지가 지나는 각 중간 노드(프록시나 게이트웨이)의 정보를 나열
2. 메세지가 또 다른 노드를 지날 떄 마다, 중간 노드는 Via 목록의 끝에 반드시 추가되어야 함
3. 다음의 Via 문자열은 두 개의 프록시를 지나갔음을 말해줌
   - 첫 번째 프록시는 HTTP/1.1 프로토콜을 구현했으며, proxy-62.irenes-isp.net이라 불림
   - 두 번쨰 프록시는 HTTP/1.0을 구현했고, cache.joes-hardware.com로 불림
<div align="center">
<img src="https://github.com/user-attachments/assets/8b212145-6b69-4c96-9d9a-78dc41d84376">
</div>

4. Via 헤더 필드는 메세지 전달을 추적하고, 메세지 루프를 전달하고, 요청을 보내고 그에 대한 응답을 돌려주는 과정에 관여하는 모든 메세지 바롱자들의 프로토콜을 다루는 능력을 알아보기 위해 사용
<div align="center">
<img src="https://github.com/user-attachments/assets/e01e13ad-cd4f-4246-bf22-3c2fed9326b2">
</div>

5. 프록시는 또한 네트워크 라우팅 루프를 탐지하기 위해 Via 헤더 사용 가능
  - 프록시는 요청을 보내기 전 자신을 가리키는 유일한(Unique) 문자열을 Via 헤더에 삽입해야 하며, 네트워크에 라우팅 루프가 있는지 탐지하기 위해 이 문자열이 들어온 요청에 있는지 검사해야 함

-----
### Via 문법
-----
1. Via 헤더 필드는 쉼표로 구분된 경유지(Waypoint) 목록
2. 각 경유지는 개별 프록시 서버나 게이트웨이 홉을 나타내며 그들 중간 노드의 프로토콜과 주소에 대한 정보를 담고 있음
3. 2개의 경유지에 대한 Via 헤더의 예
<div align="center">
<img src="https://github.com/user-attachments/assets/8b212145-6b69-4c96-9d9a-78dc41d84376">
</div>

4. Via 헤더 형식 구문
<div align="center">
<img src="https://github.com/user-attachments/assets/59aa5b49-84ad-4dc9-8e6c-ed78a9d31adf">
</div>

   - 각 Via Waypoint는 프로토콜 이름(선택, 기본은 HTTP), 프로토콜 버전(필수), 노드 이름(필수), 코멘트(선택) 최대 4개의 구성 요소를 담을 수 있음
   - 프로토콜 이름 : 중개자가 받은 프로톸콜
     + 만약 프로토콜이 HTTP라면 프로토콜 이름은 없어도 됨
     + 한편, 프로토콜 이름은 버전 앞에 /로 구분되어 붙으며, 비 HTTP 프로토콜은 게이트웨이가 다른 프로토콜(HTTPS, FTP 등)을 위해 HTTP 요청에 접속할 때 발생할 수 있음

   - 프로토콜 버전 : 수신한 메세지의 버전
     + 버전의 포맷은 프로토콜에 달려있음
     + HTTP의 경우, 표준 버전 번호(1.0 / 1.1 등)가 사용
     + 버전은 Via 필드에 포함되므로, 애플리케이션들은 자신 이전의 모든 중개자들이 어떤 버전을 다룰 수 있는지 알 수 있음

   - 노드 이름 : 중개자의 호스트와 포트 번호(선택, 만약 포트가 포함되어 있지 않다면, 사용하는 프로토콜의 기본 포트로 간주 가능)
     + 몇몇 조직은 정보 보호를 이유로 진짜 호스트 명을 밝히고 싶어하지 않을 수 있는데, 이런 경우 가명으로 대체 가능

   - 노드 코멘트 : 중개자 노드를 서술하는 선택적 코멘트
     + 벤더나 버전 정보를 여기에 포함시키는 것은 흔한 일이며, 몇몇 프록시 서버는 장치에서 일어난 이벤트에 대한 진단 정보를 포함하는 데도 코멘트 필드 사용
     + 예를 들어, 캐시 프록시 서버는 적중 / 부적중 정보를 가질 수 있음

   - Via 요청과 응답 경로 : 요청 메세지와 응답 메세지 모두 프록시를 지나므로 모두 Via 헤더를 가짐
     + 요청과 응답은 보통 같은 TCP 커넥션을 오가므로, 응답 메세지는 요청과 같은 경로를 되돌아감
     + 만약 요청 메세지가 프록시 A, B, C를 지나간다면, 그에 대한 응답 메세지는 프록시는 C, B, A를 지나감
     + 즉, 응답의 Via 헤더는 거의 언제나 요청의 Via 헤더와 반대
<div align="center">
<img src="https://github.com/user-attachments/assets/89c3a894-49b4-4bd1-bcb7-4af74e54f50d">
</div>

   - Via와 게이트웨이 : 몇몇 프록시는 서버에게 비 HTTP 프로토콜을 사용할 수 있는 게이트웨이 기능 제공
     + Via 헤더는 이러한 프로토콜 변환을 기록하므로 HTTP 애플리케이션은 프록시 연쇄에서 프로토콜 능력과 변환이 있었는지 알아챌 수 있음
     + HTTP/FTP 게이트웨이를 통해 FTP URI를 요청하는 HTTP 클라이언트 예
<div align="center">
<img src="https://github.com/user-attachments/assets/4e1e0e79-e01c-48ca-a11e-c5fa1d98982f">
</div>

   - 클라이언트는 ```ftp://http-guide.com/pub/welcom.txt```에 대한 HTTP 요청을 게이트웨이 ```proxy.irenes-isp.net```으로 보냄
   - 프로토콜 게이트웨이로 동작하는 프록시는, FTP 프로토콜을 이용해 FTP 서버로부터 원하는 객체를 받아옴
   - 그러고난 뒤, 프록시는 그 객체를 다음과 같이 Via 헤더 필드와 함께 클라이언트에게 HTTP 응답으로 돌려줌
<div align="center">
<img src="https://github.com/user-attachments/assets/05138e2b-292b-4a01-866f-edd042e67f08">
</div>

   - 수신 프로토콜이 FTP이며, 선택적인 코멘트는 프록시 서버의 브랜드, 버전 번호, 몇 가지 벤더 진단 정보 포함

   - Server 헤더와 Via 헤더 : Server 응답 헤더 필드는 원 서버에 의해 사용되는 소프트웨어를 알려줌
     + 예시
<div align="center">
<img src="https://github.com/user-attachments/assets/bfc68423-53b0-4ae5-87d4-8875e6dfc708">
</div>

   - 응답 메세지가 프록시를 통과할 때, 프록시는 Server 헤더를 수정해서는 안 되며, Server 헤더는 원 서버를 위해 존재
   - 대신 프록시는 Via 항목을 추가해야 함

   - Via가 개인 정보 보호와 보안에 미치는 영향
     + VIa 문자열 안에 정확한 호스트 명이 들어가지 않는 몇 가지 경우 존재
     + 보통 명시적으로 이 동작이 켜져 있지 않은 이상, 프록시 서버가 네트워크 방화벽 일부인 경우 프록시는 방화벽 뒤에 숨어있는 호스트 이름과 포트를 전달해서는 안 됨
     + 방화벽 네트워크 아키텍쳐에 대한 정보가 악의적 집단에 의해 이용될 수 있기 때문임
     + 만약 Via 노드 이름 전달이 가능하지 않다면, 보안 경계선의 일부분인 프록시는 호스트 명을 그 호스트에 대한 적당한 가명으로 교체해야 하지만, 이로 인해 실제 이름을 알기 어렵다고해도 일반적으로, 각 프록시 서버에 대한 Via 경유지 항목을 유지하려 노력해야 함
     + 내부 네트워크 아키텍쳐 설계와 토폴로지를 알아내기 어렵게 하기 위한 아주 강력한 보안 요구사항을 갖고 있는 조직을 위해, 정렬된 일련의 Via 경유지 항목들(수신된 프로토콜 값들이 동일한)을 하나로 합칠 수 있음
     + 예시로 아래는 하나로 합치기 가능
<div align="center">
<img src="https://github.com/user-attachments/assets/5c441dde-dba7-4a45-a811-54fc9b530acb">
</div>

   - 여러 경유지들이 모두 같은 조직 통제하에 있고, 호스트가 이미 가명으로 교체되지 않은 이상 그들에 대한 항목을 합쳐서는 안 됨
   - 또한, 수신된 프로토콜 값이 서로 다른 항목들도 합쳐서 안 됨
