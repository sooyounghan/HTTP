-----
### 캐시 처리 단계
-----
1. 오늘날 상용 프록시 캐시는 고성능이면서 HTTP와 다른 기술의 고급 기능을 지원하도록 만들어졌음
2. 웹 캐시의 기본 동작은 단순
3. HTTP GET 메세지 하나를 처리하는 기본적인 캐시 처리 절차
<div align="center">
<img src="">
</div>

   - 요청 받기 : 캐시는 네트워크로부터 도착한 요청 메세지를 읽음
   - 파싱 : 캐시는 메세지를 파싱해 URL과 헤더들을 추출
   - 검색 : 캐시는 로컬 복사본이 있는지 검사하고, 사본이 없다면 사본을 받아옴 (로컬에 저장)
   - 신선도 검사 : 캐시는 캐시된 사본이 충분히 신선한지 검사하고, 신선하지 않다면 변경사항이 있는지 서버에게 물어봄
   - 응답 생성 : 캐시는 새로운 헤더와 캐시된 본문으로 응답 메세지를 만듬
   - 발송 : 캐시는 네트워크를 통해 응답을 클라이언트에게 전달
   - 로깅 : 선택적으로, 캐시는 로그파일에 트랜잭션에 대해 서술한 로그 하나를 남김

-----
### 단계 1 : 요청 받기
-----
1. 캐시는 네트워크 커넥션에서의 활동을 감지하고, 들어오는 데이터를 읽어들임
2. 고성능 캐시는 여러 개의 들어오는 커넥션들로부터 데이터를 동시에 읽어들이고 메세지 전체가 도착하기 전 트랜잭션 처리 시작

-----
### 단계 2 : 파싱
-----
1. 캐시는 요청 메세지를 여러 부분으로 파싱하여 헤더 부분을 조작하기 쉬운 자료 구조에 저장
2. 이는 캐싱 소프트웨어가 헤더 필드를 처리하고 조작하기 쉽게 만들어줌
   - 이 파서는 헤더 부분에 대해 대소문자나 날짜 형식의 차이와 같은 중요하지 않은 차이점이 모두 무시되도록 정규화할 책임을 가지고 있음
   - 또, 어떤 요청 메세지들은 완전한 절대 URL을 갖고 있고, 어떤 메세지들은 상대 URL과 Host 헤더를 갖는데, 파서는 이러한 차이점을 대개 숨김

-----
### 단계 3 : 검색
-----
1. 캐시는 URL을 알아내고 그에 해당하는 로컬 사본이 있는지 검서
2. 로컬 복사본은 메모리에 저장되어 있을 수 있고, 아니면 디스크나 심지어 근처의 다른 컴퓨터에 있을 수 있음
3. 전문적 수준의 캐시는 로컬 캐시에서 가져올 수 있는지 판단하기 위해 빠른 알고리즘 사용
4. 만약 문서를 로컬에서 가져올 수 없다면, 캐시는 상황이나 설정에 따라 원 서버나 부모 프록시에서 가져오거나 혹은 실패 반환
5. 캐시된 객체는 서버 응답 본문과 원 서버 응답 헤더를 포함하고 있으므로, 캐시 적중 동안 올바른 서버 헤더가 반환될 수 있음
6. 캐시된 객체는 또한 객체가 얼마나 오랫동안 머무르고 있었는지를 알려주는 기록이나 얼마나 자주 사용되었는지 등에 대한 몇몇 메타데이터 포함
   - 복잡한 캐시들은 HTTP/1.1 콘텐츠 협상에 사용하기 위해, 서버 응답을 결정하기 위해 사용했던 원 클라이언트 요청 헤더들의 사본도 보관

-----
### 단계 4 : 신선도 검사
-----
1. HTTP는 캐시가 일정 기간 동안 서버 문서의 사본을 보유할 수 있도록 해줌
2. 이 기간 동안, 문서는 신선한 것으로 간주되고 캐시는 서버와 접촉 없이 이 문서를 제공할 수 있음
3. 그러나 일단 캐시된 사본을 신선도 한계를 넘을 정도로 너무 오래 가지고 있었다면, 그 객체는 신선하지 않은 것으로 간주되고, 캐시는 그 문서를 제공하기 전 문서에 어떤 변경이 있었는지 검사하기 위해 서버와 재검사를 해야함
4. HTTP 신선도 검사 규칙은 매우 복잡한데, 캐시 제품들이 지원하는 많은 수의 설정 옵션과 비 HTTP 신선도 표준과의 상호작용은 상황을 더욱 복잡하게 만듬

-----
### 단계 5 : 응답 생성
-----
1. 캐시된 응답을 원 서버에서 온 것 처럼 보이게 하고싶으므로, 캐시는 캐시된 서버 응답 헤더를 토대로 응답 헤더 생성
2. 이 기저 헤더들은 캐시에 의해 수정되고 늘어남
3. 캐시는 클라이언트에 맞게 이 헤더를 조정해야 하는 책임 존재
   - 예를 들어, 클라이언트가 HTTP/1.1 응답을 기대하는 상황에서 서버가 HTTP/1.0 응답(혹은 HTTP/0.9 응답)을 반환했다면, 캐시는 반드시 헤더를 적절하게 번역해야 함
4. 캐시는 또한 신선도 정보를 삽입하며(Cache-Control, Age, Expires 헤더), 또 요청이 프록시 캐시를 거쳐갔음을 알려주기 위해 종종 Via 헤더 포함
5. 캐시가 Date 헤더를 조정해서는 안 됨 : Date 헤더는 그 객체가 원 서버에서 최초로 생겨난 일시를 표현하는 것

-----
### 단계 6 : 전송
-----
1. 응답 헤더가 준비되면, 캐시는 응답을 클라이언트에게 돌려줌
2. 모든 프록시 서버들과 마찬가지로, 프록시 캐시는 클라이언트의 커넥션을 유지할 필요가 있음
3. 고성능 캐시는 종종 로컬 저장장치와 네트워크 I/O 버퍼 사이에서 문서 콘텐츠 복사를 피함으로써, 데이터를 효과적으로 전송하기 위해 노력

-----
### 단계 7 : 로깅
-----
1. 대부분 캐시는 로그 파일과 캐시 사용에 대해 통계 유지
2. 각 캐시 트랜잭션이 완료된 후, 캐시는 통계 캐시 적중과 부적중 횟수(그리고 다른 관련 지표들)에 대한 통계를 갱신하고 로그 파일에 요청 종류, URL 그리고 무엇이 일어났는지 알려주는 항목 추가
3. 가장 많이 쓰이는 캐시 로그 포맷 : 스퀴드 로그 포맷(Squid Log Format)과 넷스케이프 확장 공용 로그 포맷(Netscape Extended Common Log Format)이지만, 많은 캐시 제품이 커스텀 로그 파일 허용

-----
### 캐시 처리 플로 차트
-----
: 캐시가 GET 요청을 처리하는 지 보여주는 플로차트
<div align="center">
<img src="https://github.com/user-attachments/assets/db837e76-aa04-45a9-8410-61dd1814d779">
</div>
