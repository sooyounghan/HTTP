-----
### TIME_WAIT 누적과 포트 고갈
-----
1. TIME_WAIT 포트 고갈은 성능 측정 시 심각한 성능 저하를 발생시키지만, 보통 실제 상황에서는 문제를 발생시키지 않음
   - 하지만 성능 측전면에서는 성능상의 문제가 생긴것으로 오해할 수 있으므로 주의

2. TCP 커넥션 종단에서 TCP 커넥션을 끊으면, 종단에서는 커넥션의 IP 주소와 포트 번호를 메모리의 작은 제어 영역(Contorl Block)에 기록
   - 이 정보는 같은 주소와 포트 번호를 사용하는 새로운 TCP 커넥션이 일정 시간 동안 생성되지 않게 하기 위한 것으로, 보통 세그먼트의 최대 생명주기에 두 배 정도(2MSL이라고 불리며, 보통 2분 정도)의 시간 동안만 유지
   - 이는 이전 커넥션과 관련된 패킷이 그 커넥션과 같은 주소와 포트 번호를 가지는 새로운 커넥션에 삽입되는 문제 방지
   - 실제 이 알고리즘은 특정 커넥션이 생성되고 닫힌 다음, 그와 같은 IP 주소와 포트 번호를 가지는 커넥션이 2분 이내 또 생성되는 것을 막아줌
  
3. 현대의 빠른 라우터들 덕분에 커넥션이 닫힌 후에는 중복되는 패킷이 생기는 경우가 거의 없음
   - 2MSL을 더 짧은 값으로 수정하는 운영체제도 있지만, 이 값 수정은 조심해야 하는데, 만약, 이전 커넥션 패킷이 그 커넥션과 같은 연결 값으로 생성된 커넥션에 삽입되면, 패킷은 중복되고 TCP 데이터는 충돌될 것

4. 일반적으로 2MSL의 커넥션 종료 지연이 문제가 되지 않지만, 성능 시험을 하는 상황에서는 문제 발생 가능
   - 성능 측정 대상 서버는 클라이언트가 접속할 수 있는 IP 주소 개수를 제한하고, 그 서버에 접속하여 부하를 발생시킬 컴퓨터의 수는 적기 때문임
   - 게다가 일반적으로 서버는 HTTP의 기본 TCP 포트인 80번을 사용하는데, 이러한 상황에서는 가능한 연결 조합이 제한되며, TIME_WAIT로 인해 순간 포트 재활용이 불간으해짐
  
5. 각각 한 개의 클라이언트와 웹 서버가 있고, TCP 커넥션을 맺기 위한 네 개의 값이 있다고 가정
<div align="center">
<img src="https://github.com/user-attachments/assets/0118171b-be5b-43ef-a4cf-09a1852a8926">
</div>

   - 이 중 세 개는 고정되어 있고, 발신지 포트만 변경할 수 있음
<div align="center">
<img src="https://github.com/user-attachments/assets/98ca9e30-69a9-40cc-b689-315ace036c29">
</div>

  - 클라이언트가 서버에 접속할 떄마다, 유일한 커넥션을 생성하기 위해 새로운 발신지 포트를 씀
  - 하지만, 사용할 수 있는 발신지 포트의 수는 제한(60000개로 가정) 2MSL초 동안(120초 가정) 커넥션이 재사용될 수 없으므로, 초당 500개(60000 / 120 = 500)로 커넥션이 제한
  - 서버가 초당 500개 이상 트랜잭션을 처리할만큼 빠르지 않다면 TIME_WAIT 포트 고갈은 일어나지 않음
  - 이 문제를 해결하기 위해 부하를 생성하는 장비를 더 많이 사용하거나 클라이언트나 서버가 더 많은 커넥션을 맺을 수 있도록 여러 개 가상 IP 주소를 쓸 수 있음

6. 포트 고갈 문제를 겪지 않더라도, 커넥션을 너무 많이 맺거나 대기 상태로 있는 제어 블록이 너무 많아지는 상황은 주의해야 하며, 커넥션이나 제어 블록이 너무 많이 생기면 극심하게 느려지는 운영체제 존재
